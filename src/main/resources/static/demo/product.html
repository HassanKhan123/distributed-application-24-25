<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Management</title>
    <script>
        const apiUrl = 'http://localhost:9091/products';

        async function fetchProducts() {
            try {
                const response = await fetch(apiUrl);
                const products = await response.json();
                const productList = document.getElementById('productList');
                productList.innerHTML = '';

                products.forEach(product => {
                    const productItem = document.createElement('div');
                    productItem.innerHTML = `
                        <strong>${product.name}</strong> - Price: ${product.price} - Size: ${product.size} - Color: ${product.color}
                        <button onclick="deleteProduct('${product.id}')">Delete</button>
                        <button onclick="populateUpdateForm('${product.id}', '${product.name}', '${product.price}', '${product.size}', '${product.color}')">Update</button>
                    `;
                    productList.appendChild(productItem);
                });
            } catch (error) {
                console.error('Error fetching products:', error);
            }
        }

        async function deleteProduct(id) {
            if (confirm('Are you sure you want to delete this product?')) {
                try {
                    const response = await fetch(`${apiUrl}/${id}`, {
                        method: 'DELETE'
                    });
                    if (response.ok) {
                        alert('Product deleted successfully.');
                        fetchProducts(); // Refresh the product list
                    } else {
                        alert('Error deleting product.');
                    }
                } catch (error) {
                    console.error('Error:', error);
                }
            }
        }

        function populateUpdateForm(id, name, price, size, color) {
            document.getElementById('updateId').value = id;
            document.getElementById('updateName').value = name;
            document.getElementById('updatePrice').value = price;
            document.getElementById('updateSize').value = size;
            document.getElementById('updateColor').value = color;
        }

        async function updateProduct(event) {
            event.preventDefault();
            const id = document.getElementById('updateId').value;
            const name = document.getElementById('updateName').value;
            const price = document.getElementById('updatePrice').value;
            const size = document.getElementById('updateSize').value;
            const color = document.getElementById('updateColor').value;

            const product = { id, name, price, size, color };

            try {
                const response = await fetch(`${apiUrl}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(product)
                });

                const result = await response.text();
                alert(result);
                fetchProducts(); // Refresh the product list
                clearUpdateForm();
            } catch (error) {
                console.error('Error updating product:', error);
            }
        }

        function clearUpdateForm() {
            document.getElementById('updateId').value = '';
            document.getElementById('updateName').value = '';
            document.getElementById('updatePrice').value = '';
            document.getElementById('updateSize').value = '';
            document.getElementById('updateColor').value = '';
        }

        // Fetch products when the page loads
        window.onload = fetchProducts;
    </script>
</head>
<body>
    <h1>Product Management</h1>
    <div id="productList"></div>

    <h2>Update Product</h2>
    <form onsubmit="updateProduct(event)">
        <input type="hidden" id="updateId">
        <label for="updateName">Name:</label>
        <input type="text" id="updateName" required><br><br>

        <label for="updatePrice">Price:</label>
        <input type="text" id="updatePrice" required><br><br>

        <label for="updateSize">Size:</label>
        <input type="text" id="updateSize" required><br><br>

        <label for="updateColor">Color:</label>
        <input type="text" id="updateColor" required><br><br>

        <button type="submit">Update Product</button>
        <button type="button" onclick="clearUpdateForm()">Clear</button>
    </form>
</body>
</html>
